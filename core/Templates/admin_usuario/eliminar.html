{% extends '../base.html' %}
{% load static %}

{% block extra_css %}
  <link href="{% static 'css/lista.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="right_col" role="main">
  <h1>Eliminar Usuario</h1>

  <!-- Selector de usuario -->
  <div class="form-group row mb-4">
    <label class="col-4 col-form-label">Seleccionar Usuario:</label>
    <div class="col-8">
      <select id="selector-usuario" class="custom-select">
        <option value="">-- Seleccione --</option>
        {% for u in usuarios %}
          <option
            value="{{ u.id_rut }}"
            {% if usuario and u.id_rut == usuario.id_rut %}selected{% endif %}
          >
            {{ u.id_rut }} – {{ u.nombre }} {{ u.apellido }}
          </option>
        {% endfor %}
      </select>
    </div>
  </div>

  {% if usuario %}
    <div class="alert alert-danger">
      <h4><i class="fa fa-exclamation-triangle"></i> ¿Está seguro?</h4>
      <p>Está a punto de eliminar permanentemente al usuario:</p>
      <ul>
        <li><strong>RUT:</strong> {{ usuario.id_rut }}</li>
        <li><strong>Nombre:</strong> {{ usuario.nombre }} {{ usuario.apellido }}</li>
        <li><strong>Rol:</strong> {{ usuario.rol }}</li>
      </ul>

      <form method="POST" action="{% url 'eliminar_usuario' %}">
        {% csrf_token %}
        <input type="hidden" name="id_rut" value="{{ usuario.id_rut }}">

        <button type="submit" class="btn btn-delete">
          <i class="fa fa-trash"></i> Confirmar Eliminación
        </button>
        <a href="?" class="btn btn-edit ml-2">
          <i class="fa fa-times"></i> Cancelar
        </a>
      </form>
    </div>
  {% endif %}
</div>

<script>
  document
    .getElementById('selector-usuario')
    .addEventListener('change', function() {
      if (this.value) {
        window.location.href = '?rut=' + this.value;
      }
    });
</script>
{% endblock %}
